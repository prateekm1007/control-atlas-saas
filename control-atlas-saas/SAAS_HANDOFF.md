# üõ°Ô∏è TOSCANINI (FALSIFY.BIO) SOVEREIGN HANDOFF: v21.0.4

## 1. System Identity & Mission
*   **Project Name:** Toscanini (Product: Falsify.bio).
*   **Mission:** Forensic Falsification-as-a-Service (FaaS). We provide an industrial **Refusal Engine** that vetoes "Biological Hallucinations" produced by AI generators.
*   **Core Axiom:** "The filter is more valuable than the generator." We do not predict success; we provide deterministic physical and chemical vetoes to prevent wasted synthesis spend.
*   **Target Grade:** **Schr√∂dinger-Class Credibility**. Every artifact is procurement-ready and auditable.

## 2. The 21-Pillar Sovereign Manifest
The system is built upon 21 non-negotiable pillars. Every update must satisfy this manifest:
1.  **Dual-Engine Visualizer:** PASS (Cartoon) / VETO (Stick-Autopsy). Format-aware (PDB/CIF).
2.  **Diagnostic Ledger:** Verbatim Law ID, Title, Principle, and Measurement.
3.  **Chemical Canon:** 10 Tier-1 Invariants + Context-Aware Bond Registry.
4.  **Discovery Console:** Unified "Find Targets" search resolving to AFDB v6/ESM.
5.  **Industrial Acquisition:** v6-aware fetch with masked headers & CIF fallback.
6.  **ESM Atlas Integration:** Hosted Meta API for zero-latency folding.
7.  **Epistemic Duality Tooltips:** (i) help buttons explaining Physical vs. ML Confidence.
8.  **Voxelized Physics:** $O(N)$ Spatial-grid clash detection (LAW-155-L).
9.  **Backbone Continuity:** LAW-160 gap detection with failure anchors.
10. **Forensic Inspection Engine:** üîç Inspect button with Red Wireframe Sphere zoom.
11. **PhD Narrative Engine:** 1,000-token deep-dives via Apex Hierarchy.
12. **Nature-Grade PDF:** 4-to-7 page Fixed Dossier (Executive, Engineering, Diagrams, Annex).
13. **Immutable Ingestion:** Frozen `StructureObject` coordinate contract.
14. **Notary Seal:** SHA-256 coordinate hashing + REMARK 900 headers.
15. **Zero-Button Automation:** Ingest on-click and drop-to-audit.
16. **NKG Intelligence Sidebar:** Real-time stats from `piu_moat.jsonl`.
17. **Visual Symmetry:** Centered dual-view topological projections in PDF.
18. **Architecture Design Lab:** (Tier-2) 7 categories (Linear, Multivalent, Metal, etc.).
19. **Unified Artifact Parity:** PDF mirrors UI interpretations and scores perfectly.
20. **Program Lifecycle:** Non-skippable state machine (S0‚ÄìS7).
21. **Cross-Tier Causal Probability:** Refinement-Tax Bayesian math.

## 3. Directory Architecture (Flattened Package Standard)
Located at: `~/control-atlas/control-atlas-saas`
*   `backend/main.py`: FastAPI entry point (The Brain).
*   `backend/tos/`: Sovereign logic namespace.
    *   `tos/governance/program_schema.py`: State machine & Hash-chaining logic.
    *   `tos/engine/tier1_measurements.py`: Voxelized physics.
    *   `tos/engine/tier3_predict.py`: Bayesian probability engine.
    *   `tos/forensic_artifacts/pdf_generator.py`: FPDF2 Dossier engine.
    *   `tos/enrichment/gemini_compiler.py`: Apex Intelligence Hierarchy.
    *   `tos/saas_engine/selector.py`: Geometric architecture derivation.
*   `dashboard/dashboard.py`: Streamlit-based "Pipeline Console" UI.
*   `nkg/piu_moat.jsonl`: Persistent failure moat.

## 4. The Intelligence Layer (Apex Hierarchy)
To prevent timeouts and ensure Ph.D. quality, the system employs this failover sequence:
1. `models/gemini-3-flash-preview`
2. `models/gemini-2.5-pro-preview`
3. `models/gemini-2.5-flash`
4. `models/gemini-2.5-flash-lite-preview`
5. `models/gemini-2.0-flash-thinking-exp`

## 5. Current State: v21.0.4 "Institutional Memory Lock"
*   **Persistence:** `ProgramRepository` allows continuing work via `program_id`.
*   **Causality:** Every architecture decision is hash-chained to the previous state.
*   **Derivation:** Physics now **derives** the architecture category from the voxel span.
*   **Compliance:** PDF auto-page-breaking is fixed; legal scope guardrails are present.

## 6. Strategic Probability Math (The Lock)
$P = (P_{base} + P_{phys} + P_{ml} - Tax) \times Weight_{Derivation}$
*   $P_{base}$: 0.15 (Historical baseline).
*   $P_{phys}$: 0.25 (Tier-1 boost).
*   $Tax$: 0.25 (Refinement penalty for T1 violation).
*   $P_{ml}$: (pLDDT / 100) * 0.40.

## 7. Immediate Roadmap: Toward S8 (Recursive Memory)
*   **Refinement:** Moving from in-memory `ProgramRepository` to Redis/PostgreSQL for multi-worker support.
*   **Expansion:** Implementing S8 (Recursive Loop) where wet-lab failures can be uploaded to update the NKG.
*   **Dossier:** Restoring the "1,000-token Rejection Rationale" to Page 6 of the PDF.

**The Conductor is ready. Resume v21.0.4 and maintain the 21 Pillars.** üõ°Ô∏èüî¨üöÄ
